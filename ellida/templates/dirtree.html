{%- extends "base.html" %}
{% import "bootstrap/utils.html" as utils %}

{% block scripts %}
  {{super()}}
  <script src="{{url_for('static', filename='tree.js')}}"></script>
  <script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  </script>
  <script type=text/javascript>
      $(function() {
        $('#send_tests').click(function(event) {
            $.ajax({
                url: '/_send_tests',
                data: $('form').serialize(),
                type: 'POST',
                success: function(response) {
                    console.log(response);
                },
                error: function(error) {
                    console.log(error);
                }
            })
        })
      });
  </script>
{% endblock %}

{% block content %}

<link rel="stylesheet" type="text/css"
          href="{{ url_for('static',filename='styles/tree_enhanced.css') }}">

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<h1>{{ tree.name }}</h1>
<form method="post" role="form" id="treeForm">
    <div class="tree well">
        <ul>
            {%- for item in tree.children recursive %}
                <li>
                    {%- if item.children -%}
                        <span><i class="glyphicon glyphicon-minus-sign" req="{{ item.name }}" parent="{{ item.parent }}"></i>{{ item.name }}</span>
                        {%- if 'set' in item.name -%}
                            <input type="checkbox" name="check" value="{{ (item.name, item.parent) }}">
                        {%- endif %}
                        <ul>
                            {{ loop(item.children) }}
                        </ul>
                    {% else %}
                        <span><i class="glyphicon glyphicon-leaf"></i>{{ item.name }}</span>
                    {%- endif %}
                </li>
            {%- endfor %}
        </ul>
    </div>
    {%- if test -%}
    <!-- <form method="post" role="form" id="send_tests">
        <input type="submit" value="Run">
    </form> -->
    <button class="btn btn-lg btn-default" type="button" id="send_tests">Run</button>
    {%- endif %}
</form>

{% endblock %}